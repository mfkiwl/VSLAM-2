# VSLAM
SLAM学习过程记录
* [1SLAM基础知识](#1SLAM基础知识)
  * [基础矩阵F、本质矩阵E、单应矩阵H](#基础矩阵F、本质矩阵E、单应矩阵H)
  * [1-1卡方检验](#1-1卡方检验)
* [相关公司](#相关公司)

## 1SLAM基础知识

### 基础矩阵F、本质矩阵E、单应矩阵H

首先根据十四讲中作如下定义  
1.基本变量定义  
设空间点P在第一帧图像的相机坐标系下坐标：
<p align="center"><img src="https://user-images.githubusercontent.com/58176267/129569543-7e2c370b-e4fd-4411-bd23-f07365b89b2f.png"></p>  
相机内参为K  
<p align="center"><img src="https://user-images.githubusercontent.com/58176267/129570065-885775d2-39de-41ce-861f-e5341d6910f5.png"></p>  
P点在第一帧相机坐标系下深度为s1, 第二帧相机坐标系下深度为s2, R，t为相机坐标1到相机坐标系2的变换

2.本质矩阵E与基础矩阵F的推导：  

<p align="center"><img src="https://user-images.githubusercontent.com/58176267/129570421-d0f20616-dd64-424e-90b6-b683ea3e1456.png"></p>  
<p align="center"><img src="https://user-images.githubusercontent.com/58176267/129570541-e7b84d92-b40d-4d02-a4b1-f0de71815000.png"></p>  
等式两边同时除以K的逆  
<p align="center"><img src="https://user-images.githubusercontent.com/58176267/129571421-f53bd631-4781-44b6-8bfc-801cc59d5e0b.png"></p>  
<p align="center"><img src="https://user-images.githubusercontent.com/58176267/129571360-15fcea6f-472d-4ace-9632-144a2bbabf5f.png"></p>  
记x1,x2分别为两像素点的归一化平面上的坐标（相当于把P分别除以各种坐标系下的深度s1或s2，得到的坐标，本质上还是在相机坐标系的坐标）  
<p align="center"><img src="https://user-images.githubusercontent.com/58176267/129571827-04f6c4f0-42b1-4443-81ca-9b873bf8af1c.png"></p>  
<p align="center"><img src="https://user-images.githubusercontent.com/58176267/129571951-3754f82f-74fa-4a90-a270-7c626802dfee.png"></p>  
好的最后这个式子右边是个加法，不太简洁，我们左右同乘t的反对称矩阵即可消去t(可以看下反对称矩阵的概念，左乘t的反对称矩阵相当于和t做叉乘，t和自己做叉乘为0向量)  

<p align="center"><img src="https://user-images.githubusercontent.com/58176267/129572767-eea88853-a871-4d24-9c21-86d5cc9d6afa.png"></p>  
这个时候还不太简洁，要是一边能等于0就好了，左边s2是个常数，剩下的是个与t和x2都垂直的向量，所以我们两边同时乘以x2的转置，左边就等于0，为什么乘x2的专置不去乘t的专置？因为那样右边就没有x2，整个式子和第二帧图像坐标没关系了呀。 

<p align="center"><img src="https://user-images.githubusercontent.com/58176267/129573787-41318bc8-0052-41cf-8283-0cf716e8cdec.png"></p>  
最后就得到了这个式子：  

<p align="center"><img src="https://user-images.githubusercontent.com/58176267/129573985-33a7f1a5-9e08-4c50-94bc-df16f66b2bdf.png"></p>  
至于作为常数的s1和s2，我们会发现最后不管他们值为多少，都会有上面这个式子，相当于深度信息在对极约束中被“丢掉了”，其实所谓的单目尺度不确定性到底是为什么，通过这么推导下来就很明确了。  
像素坐标p1.p2再带回去就是  

<p align="center"><img src="https://user-images.githubusercontent.com/58176267/129574826-bff2d14a-4304-40f5-ab2d-1496d15012ad.png"></p>  
根据带不带内参K，就有了本质矩阵E和基础矩阵F，也就是下面两个对极约束的形式

<p align="center"><img src="https://user-images.githubusercontent.com/58176267/129575179-ea97d91e-5536-45b7-bd3b-f3e8051478b3.png"></p>  

3.单应矩阵H的推导  
单应矩阵是假设两帧图像的特征点落在同一个平面上，这样会多一个平面的约束，最后出来的H就是反应了同处于一个平面上的点在两张图像之间的变换关系。它的应用还是比较广泛的我们后面再说。  





单应矩阵
单应矩阵描述了两个平面之间的映射关系，在两个视图中特征点都处于现实世界的同一平面时，可以用单应矩阵求解两幅图像的变换关系。  
[单应矩阵推导](https://zhuanlan.zhihu.com/p/138266214)

### 1-1卡方检验
理解：如两自由度，当r<5.99时，即有95%的概率(95%的把握)认为服从自由度为2的卡方分布(我们认为只有5%的概率会把内点错误的当成外点?)
卡方检验筛除外点，[假设检验和显著性水平的概念](https://www.matongxue.com/madocs/2095/)，实际上这里的利用卡方检验剔除外点实际上是先认为我们构造的误差和服从卡方分布(对于H来说，是重投影误差，两自由度，对于F来说，是距离，1自由度)。以两自由度为例，如果假设正确，计算的r<=5.99的概率应该为95%，r>5.99的概率应该是很低的，为0.05，那么如果现在有一次实验(根据一对匹配点计算得到了一个r值)，它大于了5.99，那么我们就有很大把握认为我们的假设不正确，但是我们从经验上来说这个假设是对的(相当于是先认为假设是正确的)，那么我们就把这部分点剔除掉，因为这部分匹配点很可能是误匹配的点，才导致r大于了0.05，而不是我们的假设错误。换句话说，如果现在是在进行假设检验，我们由一对匹配点得到了r大于5.99，我们就可以说，原假设很显著的错误了(注意这个很显著的错误，并不是一定错误，是概率上的很大可能)。那反过来，如果我们先说假设是正确的呢，我们认为结果就应该呈卡方分布，那么"实验中"得到了一个r>5.99是不是我们就可以认为这个结果这次实验是显著的错误的呢，结果显著错误不就是我们选的这对匹配点是显著的误匹配吗。
补充，对卡方分布，这个r>5.99的范围叫拒绝域，即拒绝当前卡方分布的假设。
假设检验都有个显著性水平这个概念
可以看下课件卡方分布假设的过程，先有个原假假设和备选假设，求期望，求拒绝域，根据自由度和显著性水平查临界值(阈值)，看检验统计量是否在拒绝域内，做出决策(若在拒绝域内，则拒绝原假设，认为备选假设为真)。  
注意在ORBSLAM2单目初始化中，每次迭代，算出一个H,F，利用卡方检验计算评分时，是双向重投影，其中一向投影时，如果r在拒绝域，则做好是外点的标记并不计入得分，反过来计算另一向时若r不在拒绝域，则计入得分，最终这对匹配点会被标记为外点，但得分算上了一部分(这也容易理解，就是计算出来的H或者F，至少在往其中一幅图像重投影时效果还可以，那么这也算效果好的表现所以得分要加上，但是发现往另一幅图像投影时效果很不好，则最终标记为外点)。  
另外在ORBSLAM2单目初始化中，每次迭代，算出一个H,F，利用卡方检验计算评分时，是双向重投影，其中一向投影时，如果r在拒绝域，则做好是外点的标记并不计入得分，反过来计算另一向时若r不在拒绝域，则计入得分，最终这对匹配点会被标记为外点，但得分算上了一部分(这也容易理解，就是计算出来的H或者F，至少在往其中一幅图像重投影时效果还可以，那么这也算效果好的表现所以得分要加上，但是发现往另一幅图像投影时效果很不好，则最终标记为外点)。

## 相关公司
杭州云深处 四足狗 代表产品：绝影






